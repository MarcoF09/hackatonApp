final def SECRET_PROPERTY_FILE = file(rootProject.file('app/keys.properties'))
final def SECRETS = new Properties()
if (SECRET_PROPERTY_FILE.exists()) {
    SECRET_PROPERTY_FILE.withInputStream { SECRETS.load(it) }
}

ext.getSecret = { key, defaultValue = null ->
    def value = SECRETS[key]
    if (value != null) {
        return value
    }
    value = project.hasProperty(key) ? project.getProperty(key) : System.getenv(key)
    value = value?.trim() ? value : null
    if (value == null && defaultValue == null) {
        logger.warn("Variable '$key' is not defined.")
    }
    return value ?: defaultValue
}
